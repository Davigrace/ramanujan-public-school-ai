<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ramanujan School AI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ===== 1. STARTUP SCREEN & ANIMATIONS ===== */
    #startupScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(145deg, #0a0e1f 0%, #13172b 50%, #0f1220 100%);
      color: var(--text);
      z-index: 2000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
    }

    .startup-slide {
      text-align: center;
      max-width: 900px;
      width: 90%;
      padding: 40px;
      display: none;
      opacity: 0;
      transform: translateY(20px);
    }
    .startup-slide.active {
      display: block;
      animation: slideUpFadeIn 0.8s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
    }

    @keyframes slideUpFadeIn {
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes logoPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* School Logo/Image Slide - IMAGE SIZE INCREASED HERE */
    .school-logo-container {
      margin: 0 auto 40px;
      width: 320px; /* CHANGED: Increased from 180px */
      height: 320px; /* CHANGED: Increased from 180px */
      border-radius: 24px;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      display: grid;
      place-items: center;
      padding: 20px;
      border: 1px solid rgba(108, 242, 194, 0.2);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      animation: logoPulse 3s ease-in-out infinite;
    }
    .school-logo-container img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 12px;
    }

    /* Credits Slide */
    .credits-title {
      font-size: 3.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 10px;
      letter-spacing: -0.5px;
    }
    .credits-subtitle {
      font-size: 1.2rem;
      color: var(--muted);
      margin-bottom: 50px;
      font-weight: 300;
    }
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-bottom: 60px;
    }
    .team-member {
      background: rgba(255, 255, 255, 0.03);
      padding: 25px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.07);
      transition: all 0.3s ease;
    }
    .team-member:hover {
      transform: translateY(-8px);
      background: rgba(108, 242, 194, 0.05);
      border-color: rgba(108, 242, 194, 0.3);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
    .member-name {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text);
    }
    .member-role {
      font-size: 0.95rem;
      color: var(--accent);
      font-weight: 500;
      background: rgba(108, 242, 194, 0.1);
      padding: 6px 14px;
      border-radius: 100px;
      display: inline-block;
    }

    /* Start Button */
    .start-button {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #071515;
      font-size: 1.3rem;
      font-weight: 700;
      padding: 20px 50px;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      margin-top: 30px;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(108, 242, 194, 0.3);
    }
    .start-button:hover {
      transform: scale(1.05) translateY(-5px);
      box-shadow: 0 15px 40px rgba(108, 242, 194, 0.4);
    }
    .start-button:active {
      transform: scale(0.98);
    }

    /* ===== 2. YOUR ORIGINAL APP STYLES (UNCHANGED) ===== */
    :root{
      --bg:#0f1220;
      --card:#161a35;
      --accent:#6cf2c2;
      --accent2:#7aa2ff;
      --text:#e7e9ff;
      --muted:#aab0ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:
        linear-gradient(rgba(15,18,32,.75), rgba(15,18,32,.75)),
        url('assets/images/bg.png') center/cover no-repeat;
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .app{
      width:min(980px, 94vw);
      height:min(620px, 90vh);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)),
                 var(--card);
      border-radius:22px;
      box-shadow:0 30px 80px rgba(0,0,0,.45);
      display:grid;
      grid-template-rows:auto 1fr auto;
      overflow:hidden;
      position:relative;
      /* Smooth load animation for main app */
      animation: appLoad 0.8s ease-out;
    }
    @keyframes appLoad {
      from { opacity: 0; transform: translateY(20px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    header{
      padding:18px 22px;
      display:flex;
      align-items:center;
      gap:12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      position:relative;
    }
    .logo{
      width:38px;
      height:38px;
      border-radius:10px;
      background:rgba(255,255,255,.9);
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:contain;
    }
    header h1{
      font-size:18px;
      margin:0;
    }
    header span{
      color:var(--muted);
      font-size:13px;
    }
    .api-key-btn{
      margin-left:auto;
      background:rgba(108, 242, 194, 0.1);
      border:1px solid rgba(108, 242, 194, 0.3);
      color:var(--accent);
      padding:6px 12px;
      border-radius:8px;
      font-size:12px;
      cursor:pointer;
      transition:all 0.3s ease;
    }
    .api-key-btn:hover{
      background:rgba(108, 242, 194, 0.2);
    }
    .chat{
      padding:18px;
      overflow:auto;
    }
    .msg{
      max-width:78%;
      margin-bottom:14px;
      padding:12px 14px;
      border-radius:14px;
      line-height:1.45;
      word-wrap:break-word;
      /* Message animation */
      animation: messageSlideIn 0.4s ease-out forwards;
    }
    @keyframes messageSlideIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .user{
      margin-left:auto;
      background:linear-gradient(135deg, #2a3170, #2d3aa6);
    }
    .ai{
      background:#202661;
    }
    footer{
      padding:14px;
      border-top:1px solid rgba(255,255,255,.08);
      position:relative;
    }
    .input{
      display:flex;
      gap:10px;
      align-items:center;
      background:#0e1230;
      padding:10px;
      border-radius:14px;
    }
    input{
      flex:1;
      background:transparent;
      border:none;
      outline:none;
      color:var(--text);
      font-size:14px;
      transition: box-shadow 0.2s ease;
    }
    input:focus {
      box-shadow: 0 0 0 2px rgba(108, 242, 194, 0.4);
    }
    button{
      border:none;
      cursor:pointer;
      padding:10px 14px;
      border-radius:12px;
      background:linear-gradient(135deg, var(--accent), var(--accent2));
      color:#071515;
      font-weight:700;
      transition:all 0.2s ease;
    }
    button:hover{
      opacity:0.9;
      transform: translateY(-1px);
    }
    button:active{
      transform: scale(0.96);
    }
    button:disabled{
      opacity:.6;
      cursor:not-allowed;
      transform: none !important;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .api-dialog{
      position:absolute;
      top:70px;
      right:20px;
      background:var(--card);
      padding:20px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.15);
      box-shadow:0 10px 40px rgba(0,0,0,.5);
      width:320px;
      z-index:100;
      display:none;
      animation: dialogFadeIn 0.3s ease;
    }
    @keyframes dialogFadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .api-dialog.show{
      display:block;
    }
    .api-dialog h3{
      margin:0 0 15px 0;
      font-size:16px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .api-dialog h3:before{
      content:"üîë";
      font-size:14px;
    }
    .api-input-container{
      display:flex;
      gap:10px;
      margin-bottom:12px;
    }
    .api-input{
      flex:1;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.1);
      border-radius:8px;
      padding:10px 12px;
      color:var(--text);
      font-size:13px;
      font-family:monospace;
    }
    .api-input:focus{
      outline:none;
      border-color:var(--accent);
    }
    .api-status{
      font-size:12px;
      margin-bottom:15px;
      padding:8px;
      border-radius:6px;
      background:rgba(255,255,255,.05);
    }
    .api-status.valid{
      color:var(--accent);
      background:rgba(108, 242, 194, 0.1);
    }
    .api-status.invalid{
      color:#ff7a7a;
      background:rgba(255, 122, 122, 0.1);
    }
    .api-actions{
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }
    .api-actions button{
      padding:8px 16px;
      font-size:12px;
    }
    .api-actions .secondary{
      background:rgba(255,255,255,.1);
      color:var(--text);
    }
    .api-actions .secondary:hover{
      background:rgba(255,255,255,.15);
    }
    .api-help{
      font-size:11px;
      color:var(--muted);
      margin-top:12px;
      line-height:1.4;
    }
    .api-help a{
      color:var(--accent);
      text-decoration:none;
    }
    .api-help a:hover{
      text-decoration:underline;
    }
    .typing-indicator{
      display:flex;
      gap:4px;
      padding:8px 12px;
    }
    .typing-indicator span{
      width:8px;
      height:8px;
      background:var(--accent);
      border-radius:50%;
      animation:typing 1.4s infinite ease-in-out;
    }
    .typing-indicator span:nth-child(1){animation-delay:-0.32s;}
    .typing-indicator span:nth-child(2){animation-delay:-0.16s;}
    @keyframes typing{
      0%, 80%, 100%{transform:scale(0.6); opacity:0.3;}
      40%{transform:scale(1); opacity:1;}
    }
    .close-dialog{
      position:absolute;
      top:12px;
      right:12px;
      background:none;
      border:none;
      color:var(--muted);
      font-size:18px;
      cursor:pointer;
      width:24px;
      height:24px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:50%;
      transition:all 0.3s ease;
    }
    .close-dialog:hover{
      background:rgba(255,255,255,.1);
      color:var(--text);
    }
    
    /* Credits Dialog */
    .credits-dialog{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      background:var(--card);
      padding:25px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.15);
      box-shadow:0 15px 50px rgba(0,0,0,.6);
      width:400px;
      max-width:90vw;
      z-index:100;
      display:none;
      animation: dialogFadeIn 0.3s ease;
    }
    .credits-dialog.show{
      display:block;
    }
    .credits-dialog h3{
      margin:0 0 20px 0;
      font-size:20px;
      display:flex;
      align-items:center;
      gap:10px;
      color:var(--accent);
    }
    .credits-dialog h3:before{
      content:"‚≠ê";
      font-size:18px;
    }
    .credits-content{
      font-size:14px;
      line-height:1.6;
      color:var(--text);
      margin-bottom:20px;
    }
    .credits-content p{
      margin:0 0 15px 0;
    }
    .credits-content strong{
      color:var(--accent);
    }
    .credits-close{
      display:block;
      margin-left:auto;
      padding:8px 20px;
      font-size:13px;
    }
    .credits-btn{
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      color:var(--muted);
      padding:4px 10px;
      border-radius:6px;
      font-size:11px;
      cursor:pointer;
      transition:all 0.3s ease;
    }
    .credits-btn:hover{
      background:rgba(255,255,255,0.1);
      color:var(--text);
    }
  </style>
</head>
<body>
  <!-- ===== STARTUP SCREENS ===== -->
  <div id="startupScreen">
    <!-- Slide 1: School Information -->
    <div class="startup-slide active" id="slideSchool">
      <div class="school-logo-container">
        <!-- YOUR UPLOADED IMAGE IS USED HERE -->
        <img src="assets/images/images.png" alt="Ramanujan Public School" />
      </div>
      <h1 style="font-size: 2.8rem; margin-bottom: 15px;">Ramanujan Public School</h1>
      <p style="font-size: 1.1rem; color: var(--muted); line-height: 1.7; max-width: 600px; margin: 0 auto 30px;">
        Sanapur Urf Pepalgaon (Oppt. IIIT, Jhalwa)<br>
        Allahabad-211012<br>
        Phone: +91-7752922226<br>
        E-mail: rpsjhalwa.all@gmail.com
      </p>
      <p style="font-size: 1.8rem; font-weight: 600; margin-top: 40px; color: var(--accent);">
        Presents
      </p>
      <h2 style="font-size: 3rem; font-weight: 700; background: linear-gradient(90deg, #6cf2c2, #7aa2ff); -webkit-background-clip: text; background-clip: text; color: transparent; margin: 10px 0 40px 0;">
        School AI Assistant
      </h2>
      <button class="start-button" onclick="showNextSlide()">
        Meet the Team <span style="font-size: 1.2rem;">‚Üí</span>
      </button>
    </div>

    <!-- Slide 2: Team Credits -->
    <div class="startup-slide" id="slideTeam">
      <div class="credits-title">Project Credits</div>
      <div class="credits-subtitle">Built with dedication by the students of Class XI-B</div>

      <div class="team-grid">
        <!-- Team Members in the specified order -->
        <div class="team-member">
          <div class="member-name">Priyansh</div>
          <div class="member-role">Developer & Presenter</div>
        </div>
        <div class="team-member">
          <div class="member-name">Vansh</div>
          <div class="member-role">Presenter</div>
        </div>
        <div class="team-member">
          <div class="member-name">Shreyash</div>
          <div class="member-role">Presenter</div>
        </div>
        <div class="team-member">
          <div class="member-name">Sherya</div>
          <div class="member-role">Presenter</div>
        </div>
        <div class="team-member">
          <div class="member-name">Anshika</div>
          <div class="member-role">Presenter</div>
        </div>
        <div class="team-member">
          <div class="member-name">Ananya</div>
          <div class="member-role">Presenter</div>
        </div>
        <div class="team-member">
          <div class="member-name">Ankit</div>
          <div class="member-role">Presenter</div>
        </div>
        <div class="team-member">
          <div class="member-name">Kashfa</div>
          <div class="member-role">Presenter</div>
        </div>
        <div class="team-member">
          <div class="member-name">Utkarshini</div>
          <div class="member-role">Presenter</div>
        </div>
      </div>

      <button class="start-button" onclick="startChatApp()">
        Start Chatting <span style="font-size: 1.2rem;">üöÄ</span>
      </button>
    </div>
  </div>

  <!-- ===== YOUR ORIGINAL CHAT APP (HIDDEN INITIALLY) ===== -->
  <div class="app" id="mainApp" style="display: none;">
    <!-- API Key Dialog -->
    <div id="apiDialog" class="api-dialog">
      <button class="close-dialog" id="closeDialog">√ó</button>
      <h3>Groq API Key</h3>
      <div class="api-input-container">
        <input type="password" id="apiInput" class="api-input" placeholder="Enter your API key..." />
        <button id="saveKey" class="small">Save</button>
      </div>
      <div id="apiStatus" class="api-status">
        Status: No API key saved
      </div>
      <div class="api-actions">
        <button id="clearKey" class="secondary">Clear Key</button>
        <button id="testKey" class="secondary">Test Key</button>
      </div>
      <div class="api-help">
        Get your free API key from
        <a href="https://console.groq.com" target="_blank">Groq Console</a>.
        Keys are stored locally in your browser only.
      </div>
    </div>

    <!-- Credits Dialog -->
    <div id="creditsDialog" class="credits-dialog">
      <button class="close-dialog" id="closeCreditsDialog">√ó</button>
      <h3>Project Credits</h3>
      <div class="credits-content">
        <p>This AI Assistant was developed with the assistance of <strong>DeepSeek AI</strong>, which provided coding guidance and implementation support.</p>
        
        <p>The AI capabilities are powered by <strong>Groq Cloud API</strong> through the Groq Console, providing fast and efficient language model processing.</p>
        
        <p>All code was written by students of <strong>Class XI-B, Ramanujan Public School, Prayagraj, Jhalwa</strong> as an educational project.</p>
        
        <p>Features include:</p>
        <ul style="margin: 10px 0 15px 20px; padding: 0;">
          <li>Offline knowledge base for quick answers</li>
          <li>Online AI integration via Groq API</li>
          <li>Local browser storage for API keys</li>
          <li>Responsive design for all devices</li>
        </ul>
      </div>
      <button class="credits-close" id="closeCreditsBtn">Close</button>
    </div>

    <header>
      <div class="logo"><img src="assets/images/logo.png" alt="School Logo"></div>
      <div>
        <h1>Ramanujan School AI</h1>
        <span>Homework help ‚Ä¢ Concepts ‚Ä¢ Practice</span>
      </div>
      <button class="api-key-btn" id="openApiDialog">
        üîë API Key
      </button>
    </header>

    <div id="chat" class="chat">
      <div class="msg ai">Hello! I'm Ramanujan School AI. Ask me any school question üôÇ</div>
    </div>

    <footer>
      <div class="input">
        <input id="q" placeholder="Type your question..." />
        <button id="send">Send</button>
      </div>
      <div class="hint">
        <span id="modeIndicator">üî¥ Offline Mode</span>
        <button class="credits-btn" id="openCreditsDialog">Credits</button>
      </div>
    </footer>
  </div>

<script>
  /* ===== STARTUP SCREEN LOGIC ===== */
  let currentSlide = 0;
  const slides = document.querySelectorAll('.startup-slide');

  function showNextSlide() {
    slides[currentSlide].classList.remove('active');
    currentSlide++;
    if (currentSlide < slides.length) {
      slides[currentSlide].classList.add('active');
    } else {
      startChatApp();
    }
  }

  function startChatApp() {
    // 1. Animate out the startup screen
    const startupScreen = document.getElementById('startupScreen');
    startupScreen.style.opacity = '0';
    startupScreen.style.transform = 'scale(1.05)';
    startupScreen.style.transition = 'opacity 0.6s ease, transform 0.6s ease';

    // 2. Wait for fade out, then hide it and show main app
    setTimeout(() => {
      startupScreen.style.display = 'none';
      document.getElementById('mainApp').style.display = 'grid';
      // Focus the input field for immediate typing
      document.getElementById('q').focus();
    }, 600);
  }

  /* ===== YOUR ORIGINAL CHAT APP JAVASCRIPT ===== */
  let GROQ_API_KEY = localStorage.getItem('GROQ_API_KEY');
  const dialog = document.getElementById('apiDialog');
  const openBtn = document.getElementById('openApiDialog');
  const closeBtn = document.getElementById('closeDialog');
  const apiInput = document.getElementById('apiInput');
  const saveKey = document.getElementById('saveKey');
  const clearKey = document.getElementById('clearKey');
  const testKey = document.getElementById('testKey');
  const apiStatus = document.getElementById('apiStatus');
  const modeIndicator = document.getElementById('modeIndicator');
  
  // Credits dialog elements
  const creditsDialog = document.getElementById('creditsDialog');
  const openCreditsBtn = document.getElementById('openCreditsDialog');
  const closeCreditsBtn = document.getElementById('closeCreditsBtn');
  const closeCreditsDialogBtn = document.getElementById('closeCreditsDialog');

  function updateApiStatus() {
    if (GROQ_API_KEY) {
      const maskedKey = `${GROQ_API_KEY.substring(0, 10)}...${GROQ_API_KEY.substring(GROQ_API_KEY.length - 4)}`;
      apiStatus.textContent = `‚úÖ API Key saved: ${maskedKey}`;
      apiStatus.className = 'api-status valid';
      modeIndicator.textContent = 'üü¢ Online Mode';
      modeIndicator.style.color = '#6cf2c2';
    } else {
      apiStatus.textContent = 'üî¥ No API key saved (Offline mode only)';
      apiStatus.className = 'api-status invalid';
      modeIndicator.textContent = 'üî¥ Offline Mode';
      modeIndicator.style.color = '#ff7a7a';
    }
  }

  updateApiStatus();

  // API Dialog functions
  openBtn.onclick = (e) => {
    e.stopPropagation();
    dialog.classList.toggle('show');
    if (dialog.classList.contains('show')) {
      apiInput.value = GROQ_API_KEY || '';
      apiInput.focus();
    }
  };
  closeBtn.onclick = () => { dialog.classList.remove('show'); };
  
  // Credits Dialog functions
  openCreditsBtn.onclick = (e) => {
    e.stopPropagation();
    creditsDialog.classList.add('show');
  };
  
  closeCreditsBtn.onclick = () => { creditsDialog.classList.remove('show'); };
  closeCreditsDialogBtn.onclick = () => { creditsDialog.classList.remove('show'); };
  
  // Close dialogs when clicking outside
  document.addEventListener('click', (e) => {
    if (!dialog.contains(e.target) && e.target !== openBtn) { dialog.classList.remove('show'); }
    if (!creditsDialog.contains(e.target) && e.target !== openCreditsBtn) { creditsDialog.classList.remove('show'); }
  });

  saveKey.onclick = () => {
    const v = apiInput.value.trim();
    if (v) {
      if (v.length < 20) {
        apiStatus.textContent = '‚ùå Key seems too short. Please check.';
        apiStatus.className = 'api-status invalid';
        return;
      }
      localStorage.setItem('GROQ_API_KEY', v);
      GROQ_API_KEY = v;
      updateApiStatus();
      dialog.classList.remove('show');
      add('Groq API key saved successfully! You can now use online features.', 'ai');
    }
  };

  clearKey.onclick = () => {
    localStorage.removeItem('GROQ_API_KEY');
    GROQ_API_KEY = null;
    apiInput.value = '';
    updateApiStatus();
    add('API key cleared. Switching to offline mode.', 'ai');
  };

  testKey.onclick = async () => {
    if (!GROQ_API_KEY) {
      apiStatus.textContent = '‚ùå No API key to test';
      apiStatus.className = 'api-status invalid';
      return;
    }
    apiStatus.textContent = 'üîÑ Testing Groq API key...';
    apiStatus.className = 'api-status';
    try {
      const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${GROQ_API_KEY}`
        },
        body: JSON.stringify({
          messages: [{ role: 'user', content: 'Say "API test successful" if you can read this.' }],
          model: 'llama-3.1-8b-instant'
        })
      });
      if (response.ok) {
        apiStatus.textContent = '‚úÖ Groq API key is working!';
        apiStatus.className = 'api-status valid';
      } else {
        const error = await response.json();
        let errorMsg = `‚ùå API error: ${error.error?.message || 'Unknown error'}`;
        apiStatus.textContent = errorMsg;
        apiStatus.className = 'api-status invalid';
      }
    } catch (err) {
      apiStatus.textContent = '‚ùå Network error - check connection';
      apiStatus.className = 'api-status invalid';
    }
  };
  apiInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') saveKey.click(); });

  const chat = document.getElementById('chat');
  const q = document.getElementById('q');
  const send = document.getElementById('send');

  const JAGANNATH_KB = `
Lord Jagannath is a revered form of Lord Vishnu/Krishna, worshipped primarily in Odisha, India.
He is traditionally worshipped along with his siblings: Lord Balabhadra and Devi Subhadra.

Jagannath Puri Temple is one of the Char Dham pilgrimage sites of Hinduism and is located in Puri, Odisha.

A unique feature of Jagannath worship is the wooden idols (daru brahma), which are ritually renewed in the Nabakalebara ceremony.

The annual Rath Yatra is a major festival where the deities are taken out on massive chariots for public darshan.

Jagannath symbolizes universality, compassion, and inclusiveness.
`;

  const MATH_KB = {
    'pythagoras': 'The Pythagorean theorem states: a¬≤ + b¬≤ = c¬≤, where c is the hypotenuse of a right triangle.',
    'quadratic': 'The quadratic formula: x = [-b ¬± ‚àö(b¬≤ - 4ac)] / 2a',
    'algebra': 'Algebra is the branch of mathematics dealing with symbols and rules for manipulating those symbols.',
    'geometry': 'Geometry studies shapes, sizes, positions, and properties of space.',
    'calculus': 'Calculus is the mathematical study of continuous change.'
  };

  function isGreeting(t) { return /^(hi|hello|hey|namaste|good morning|good afternoon|good evening)/i.test(t); }
  function isHowAreYou(t) { return /(how are you|how r u|how're you)/i.test(t); }
  function isJagannathQuery(t) { return /(jagannath|puri|rath yatra|nabakalebara|mahaprasad|balabhadra|subhadra)/i.test(t); }
  function isMathQuery(t) {
    const lower = t.toLowerCase();
    for (const key in MATH_KB) { if (lower.includes(key)) return MATH_KB[key]; }
    return null;
  }
  function offlineReply(text) {
    text = text.toLowerCase().trim();
    if (isGreeting(text)) return 'Hello! How may I assist you with your studies today?';
    if (isHowAreYou(text)) return 'I am functioning well. Ready to help with your questions!';
    if (isJagannathQuery(text)) return JAGANNATH_KB;
    const mathReply = isMathQuery(text); if (mathReply) return mathReply;
    if (text.includes('api') || text.includes('key')) return 'You can manage your API key by clicking the "API Key" button in the top right.';
    if (text.includes('credit') || text.includes('made by') || text.includes('who made') || text.includes('developed')) 
      return 'I am Ramanujan School AI, made by a group of developers in Class XI-B of Ramanujan Public School, Prayagraj, Jhalwa. Click the "Credits" button below for more details.';
    return null;
  }

  function add(text, cls, isTyping = false) {
    const d = document.createElement('div');
    d.className = `msg ${cls}`;
    if (isTyping) {
      d.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;
      d.id = 'typing-msg';
    } else { d.textContent = text; }
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
    return d;
  }
  function removeTypingIndicator() {
    const typingMsg = document.getElementById('typing-msg');
    if (typingMsg) typingMsg.remove();
  }

  async function ask() {
    const text = q.value.trim();
    if (!text) return;
    q.value = '';
    add(text, 'user');
    send.disabled = true;
    q.disabled = true;

    let typingIndicator = null;
    if (!offlineReply(text)) typingIndicator = add('', 'ai', true);

    const local = offlineReply(text);
    if (local) {
      setTimeout(() => {
        removeTypingIndicator();
        add(local, 'ai');
        send.disabled = false;
        q.disabled = false;
        q.focus();
      }, 500);
      return;
    }

    if (!GROQ_API_KEY) {
      removeTypingIndicator();
      add('To answer this question, I need to use online features. Please add your Groq API key by clicking the "API Key" button in the top right.', 'ai');
      send.disabled = false;
      q.disabled = false;
      q.focus();
      dialog.classList.add('show');
      return;
    }

    try {
      const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${GROQ_API_KEY}`
        },
        body: JSON.stringify({
          messages: [
            {
              role: 'system',
              content: 'You are Ramanujan School AI, a helpful assistant for students. Answer questions clearly and concisely.'
            },
            {
              role: 'user',
              content: text
            }
          ],
          model: 'llama-3.1-8b-instant',
          temperature: 0.7,
          max_tokens: 500
        })
      });
      removeTypingIndicator();
      if (!response.ok) {
        const error = await response.json();
        let errorMsg = '';
        if (error.error?.type === 'invalid_request_error') {
          errorMsg = 'API key error. Please check your key is valid.';
          updateApiStatus();
        } else if (error.error?.code === 'rate_limit_exceeded') {
          errorMsg = 'Rate limit reached. Please wait a moment.';
        } else {
          errorMsg = `Error: ${error.error?.message || 'Unknown error'}`;
        }
        add(errorMsg, 'ai');
      } else {
        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content || 'I received an empty response. Please try again.';
        add(reply, 'ai');
      }
    } catch (err) {
      removeTypingIndicator();
      console.error('Request failed:', err);
      add('Network error. Please check your connection and try again.', 'ai');
    }
    send.disabled = false;
    q.disabled = false;
    q.focus();
  }

  send.onclick = ask;
  q.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      ask();
    }
  });
</script>
</body>
</html>
